---
title: QGis专题地图编制
date: 2020-01-14 16:43:34
tags:
	- QGis
categories:
	- GIS
fileName: qgis-thematic-map-drawing
---

## 主要内容

本次任务是制作蕲春县株林镇的土地覆盖专题图，因此重点主要是通过一些空间分析方法对相关数据进行处理，从而得到相关专题数据，同时，对专题图底图也应在实习一的基础上进行简化修改，总结而言，本次任务具体环节如下：

1、对之前的TDFG数据添加村代码和村名。使用按位置连接等工具连接相关的村名、村代码。

2、土地利用数据的权属数据和行政区数据整理。xzq数据与地类图斑数据边界不一致，需要处理成为一致的。同时增加一个新的村，有自己的学号，以及自己命名一个村名。以改好权属的dltb为基础，采用融合方法，按权属代码融合得到新的xzq层，并转一个新界线层。

3、准备专题图数据。使用相应方法统计与计算各村各大类的各种面积属性项，如耕地面积、人均耕地面积、人口等等。

4、制作专题地图底图。图纸采用A4大小，版式自己进行设计横版或竖版；注意主图比例尺设计合适，使主图、整饰要素、统计图表、图文等要素布局均衡、松紧适宜。底图要素保留行政界线、主要河流、水库、居民点；道路根据各自设计处理。增加必要的地图注记，如选取居民点、主要河流、水库等名称，可采用标注方法。

5、制作专题地图主图。以输入专题数据的xzq为基础，用渐变填色方法制作人均耕地分级色图；由XZQ生成质点，加载质点数据，用结构图方法制作各类用地结构图表；根据全市或分村统计各坡度级耕地面积，制作图外统计图表。

6、制作专题图整饰。添加色带、图名、指北针、数字比例尺、位置图、图例等。

## 土地利用数据的权属数据整理

### 添加村代码和村名

此处总体步骤为使用实习一中的TDFG数据，对各地类多边形进行求质心操作，进而通过对质心位置的判断，链接上村名和村代码。本人的具体操作如下。

1、首先对实习1中的TDFG数据，选择“矢量”下的“拓扑结构检查器”（需要在插件中加载该功能）进行拓扑检查（检查无效多边形），避免生成质心时QGIS报错。如下图1即为本次实习中有拓扑错误的多边形。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%871.png" style="zoom:67%;" />

2、根据拓扑错误对多边形进行修改，主要应避免如下图的拓扑错误，方法为在该处取消吸附功能。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%872.png" style="zoom:33%;" />

3、对修改后的TDFG图层进行求质心操作，可右击菜单栏打开“处理工具箱”工具，之后的一系列相关操作功能都可在该工具栏中进行搜索获得。如下一图即为“质心”工具运行结果，如下二图为求质心之后的效果。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%873.png" style="zoom: 80%;" />

4、使用“按位置连接”工具，选择“内含于”等选项，运行结果如下。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%874.png" style="zoom:67%;" />

5、选择“按字段值连接属性”，各选项如下。完成村名和村代码的添加。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%875.png" style="zoom: 50%;" />

### 按各村界线进行图形分割

本步骤主要就是按照实习一中的XZQ图层对各个跨越XZQ的图版进行分割（主要就是实习一中补充的那部分），方法是启动编辑后使用“编辑”中的“分割要素”工具对图形进行切割，如图所示。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%876.png" style="zoom: 50%;" />

### 新增村庄

按照要求，随便选一块区域，将属性表中的村名、村代码进行更改，形成一个新的村子，如图所示。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%877.png" style="zoom: 50%;" />

### 融合

融合的目的即为使属性表中为一个村的地区真正“融”为一个村，从而形成的边界图层替代实习一中的XZQ图层，为之后的专题图制作提供基础底图。本次实习先使用了QGIS中的融合工具，但效果不佳，有如下图所示的裂纹，无法使用。

![](http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%878.png)

鉴于此，本次实习在该功能上使用了ArcGIS中的“融合”功能，其相关参数如下（由于数据源的问题，村名中出现了一些代码，因此本处使用村代码作为融合依据，之后根据村名和村代码的对应关系将村名链接了上去）。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%879.png" style="zoom:50%;" />

由于之前在QGIS中对部分图形进行了切割的缘故，在ArcGIS生成的融合图形中仍有部分毛边，本次实习在ArcGIS中启用编辑，使用“删除点”工具对这些毛边进行了处理，同时使用“添加点”功能对部分细小缝隙进行了修补，以避免之后生成质心时出现拓扑错误，完成操作后使用QGIS打开相关shp文件，效果如下。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8710.png" style="zoom: 33%;" />

## 专题图数据处理与统计

### 相关数据的分村统计

所需的数据主要包括各村的面积、人口、各大类地面积、人均耕地面积等数据，除去人口数据是需要自己进行输入，其余都需通过各分析方法得到。

1、对2.1节中得到的“新界线”图层TDFG_RH添加新字段，主要内容为以上所述的各内容，类型选择为“小数”。 

2、在“处理工具箱”中搜索找到“添加几何属性”功能，输入要素如下图，得到一个有相关面积等数据的图层，将该临时图层中相关字段中的面积数据连接到TDFG_RH中的相关字段，得到各村面积数据。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8711.png" style="zoom:50%;" />

3、在“处理工具箱”中搜索找到“按类别统计工具”，输入要素如下图1所示，字段选择为地类字段和村名字段。之后程序输出为一个表格，“打开属性表”打开之后，可见其信息如下图2，各村的各类面积都已补充完整，将相关数据填入TDFG_RH中的相关字段即可。

![](http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8712.png)

4、将TDFG_RH图层中的RK（人口）字段按照相关资料（主要是网上相关的资料）进行填入，大致区间在300-1300人之间，之后打开编辑后，使用“字段计算器”，填入相应内容后，将RJGDMJ（人均耕地面积）进行计算与填入。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8713.png" style="zoom:50%;" />

### 坡度的分村统计

坡度的统计需要借用ArcGIS中的相关功能以及已有的DGX、GCD等数据，主要步骤如下。 

1、在ArcGIS中借用“3D Analyst工具”->“数据管理”->“TIN”->“创建TIN”，输入如下图1参数，得到TIN数据如下图2。TIN数据与DEM数据最大的区别是一个是矢量数据一个是栅格数据，因此要实现转化须将其进行矢栅转化。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8714.png" style="zoom: 50%;" />

2、“3D Analyst工具”->“转换”->“由TIN转出”->“TIN转栅格”，实现TIN数据与DEM数据的转化，具体输入见下图1，DEM数据效果见下图2。

![](http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8715.png)

3、使用ArcGIS中的“坡度”工具，将DEM数据输入，得到相应的坡度图，效果如下两图。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8716.png" style="zoom: 67%;" />

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8717.png" style="zoom:50%;" />

4、使用ArcGIS中的转换工具（可以直接转也可以使用ArcToolBoxzhon给的相关工具）将坡度图导出为tif格式，并将其导入QGIS，如图所示。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8718.png" style="zoom:50%;" />

5、使用“分区统计”工具对各村坡度进行计算，该程序运行完之后会发现输入的TDFG_RH图层中多了三个计算图层，如下。

![](http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8719.png)

6、取上表的相关数据导入excel中进行数据统计，便于之后绘制图表。

## 制作专题地图底图

在《QGis地表覆盖图编制》基础上进行要素选取，最后结果如下

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8720.png" style="zoom:50%;" />

## 制作专题地图主图

### 分级设色

1、在相关图层的属性下的“符号”中，进行如下选择，可得到分级设色的效果。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8721.png" style="zoom:50%;" />

2、调整相关颜色（颜色1与颜色2）如下，使其符合基本的色彩视觉要求要求。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8722.png" style="zoom:50%;" />

3、完成分级设色，效果如下。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8723.png" style="zoom:50%;" />

### 饼状图绘制

1、利用质心工具对新界线进行求质心操作，得到质心图如下，同时该质心图层已经包含了TDFG_RH中在2.2.2中进行统计后的字段。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8724.png" style="zoom:50%;" />

2、利用已经统计了的数据实现饼状图的绘制，在属性中“图表”中进行如下选择，可实现饼状图绘制，更改颜色后，完成饼状图绘制。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8725.png" style="zoom:67%;" />

3、由于饼状图的图例绘制在QGIS中效果不好，因此本次实习选择在AI中对其进行绘制，绘制完成后如下，可导出为PNG格式。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8726.png" style="zoom: 80%;" />

4、整体效果如下。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8727.png" style="zoom: 50%;" />

### 柱状图

同样根据统计数据使用AI进行绘制，不再赘述

## 地图整饰

地图整饰包括制作色带、图名、指北针、数字比例尺、位置图、图例等内容，本节也以此为基础进行相关叙述。其中其余参考《QGis地表覆盖图编制》即可

### 位置图

1、将位置图图片导入项目，并使用配准工具对其进行处理，如下图所示。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8728.png" style="zoom:50%;" />

2、使用QGIS中的“栅格矢量化”工具对该位图进行矢量化，具体见面如下，可得到位置图的矢量图（本次实习使用该功能效果不太好）

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8729.png" style="zoom:67%;" />

3、对其进行分类处理，并新增一个MC（名称）字段，调整颜色，设置标志（注记），即完成位置图的制作，效果如下。

![](http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8730.png)

### 图例

1、在菜单栏左侧使用相应工具添加图例，并设置其条目属性，并将图例置于右下角，效果如下。

<img src="http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8731.png" style="zoom:50%;" />

2、将4.2小节中绘制好的饼状图图例以导入图片的形式导入，并将其置于右下角。

## 整体效果

![](http://cdn.ziyedy.top/image/QGis%E4%B8%93%E9%A2%98%E5%9C%B0%E5%9B%BE%E7%BC%96%E5%88%B6/%E5%9B%BE%E7%89%8732.png)