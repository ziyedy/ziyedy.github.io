---
title: 数据库常见问题
date: 2021-03-16 14:34:46
tags:
categories:
fileName:
---

# 索引

## 索引目的与原理

> 索引是存储引擎用于快速找到记录的一种数据结构

优点：

- 减少扫描的数据量，加速查询
- 减少或完全消除数据库的排序操作（ORDER BY），因为索引是有序的
- 将服务器的随机 IO 变为顺序 IO，例如，想要查询 salary 处于 1500 ~ 2100 的员工，就可以按照索引顺序查询

缺点：

- 索引会占据额外的存储空间（毕竟它是数据结构），包括磁盘和内存
- 由于对数据需要排序，自然会影响到数据更新（插入、更新、删除）的速度



## InnoDB索引实现

不同的存储引擎自然也就会有各自不同的实现

对于 InnoDB 而言，它的内部实现使用的是 B+ 树

使用B+树的原因：

- 中间节点不保存真实数据，就可以去存储更多的索引数据，以降低整体树的层级，减少磁盘 IO 的次数，提高查询性能
- 所有的数据都保存在叶子节点，查询的次数也就是相同的，查询稳定性很高
- 叶子节点之间顺序链接在一起，范围查询的效率极高



## 为什么在Innodb用B+树而不用B树？

B+树只有叶节点存放数据，其余节点用来索引，而B树是每个索引节点都会有Data域。所以使用B+树能够**减少索引对内存的占用**

B+树除了叶子节点比较小，所以相对于B树，**磁盘的IO次数小**

B+树在叶子节点通常使用指针将所有叶子节点连接起来，因此**能够有效支持数据库常用的区间访问（范围访问）**，而B树不行

同时B+树每次查询的时间效率比较平均（都是经过相同次查找），因此用在数据库中效率更加稳定



## 为什么数据库不采用红黑树等平衡树呢

**AVL 数和红黑树基本都是存储在内存中才会使用的数据结构**。在大规模数据存储的时候，红黑树往往出现由于**树的深度过大**而造成磁盘IO读写过于频繁，进而导致效率低下的情况



## 为什么不采用哈希索引

哈希索引能较好的适应等值查找，但无法应对范围查找，也无法利用索引完成排序

哈希索引不支持多列联合索引的最左匹配规则（数据量大会频繁发生哈希碰撞）



### 为什么建议InnoDB表必须建主键，并且推荐使用整型的自增主键

UUID唯一识别码，不一定有序



## MySQL聚簇索引与非聚簇索引的区别

### 聚簇索引

InnoDB中的一个特殊概念，并不是一种索引类型，而是一种存储数据的方式

InnoDB 规定一个表只能有一个聚簇索引，且会使用主键来创建（因此InnoDB推荐使用自增主键，因为自增主键会使插入效率大大提高）

### 联合索引

对于非聚簇索引而言，实际存储的是记录主键，所以，还需要根据主键再做一次查询才可以获取到数据



### 磁盘IO与预读

**数据库系统的设计者巧妙利用了磁盘预读原理**，将一个节点的大小设为等于一个页，这样每个节点只需要一次I/O就可以完全载入。为了达到这个目的，在实际实现B-Tree还需要使用如下技巧：每次新建节点时，直接申请一个页的空间，这样就保证**一个节点物理上也存储在一个页里**，加之计算机存储分配都是按页对齐的，就实现了一个node只需一次I/O。



### 联合索引

索引最左前缀原则



### EXPLAIN语句

Explain 命令是查看查询优化器如何决定执行查询的主要方法

通常的操作是我们会开启慢查询，让慢查询日志去记录一些执行时间比较长的SQL语句，找出这些SQL语句后，就需要用explain这个命令来查看一个这些SQL语句的执行计划，查看该SQL语句有没有使用上了索引，有没有全表扫描、表如何连接及连接顺序等。

所以我们通过对查询语句的分析，可以了解查询语句的执行情况，找出查询语向执行的瓶颈，从而优化查询语句。



[MySQL Explain语句分析_@日月空@的博客-CSDN博客](https://blog.csdn.net/qq_41993206/article/details/109662088)





## 索引设计的几大原则

查询更快，占用空间更小



Mysql的主键索引和其他的索引的区别。

覆盖索引。

binlog的作用。

redolog作用。

undolog作用。以及undolog的存储结构。



### 1000万条数据使用主键索引要查多少次

https://blog.csdn.net/dl674756321/article/details/102987984





# 锁







